> ## 分布式

## 集群、分布式、微服务区别?
- 集群:  将一个应用复制部署到多个服务器上
- 分布式: 将应用拆分为不同系统部署到不同服务器上
- 微服务: 分布式的细化, 与其类似, 但不同系统可以部署到一个服务器上

## 微服务的优点与缺点?
优点: 
- 微服务很小, 可以聚焦到一个指定的业务功能或业务需求
- 能够被小团队开发
- 可以使用不同语言开发
- 小团队更加关注自己的工作
- 只是实现业务逻辑代码, 不会与HTML, CSS等其它界面组合

缺点: 
- 要理解整个系统很难
- 部署、运维更加困难, 要监控多个节点
- 链路跟踪困难
- 数据一致性问题
- 测试难度加大

## 分布式锁的实现?
- zookeeper
- 数据库id
- 缓存Redis中的SENX指令

## CAP理论? BASE理论?
- CAP: Consistency(一致性)、 Availability(可用性)、Partition tolerance(分区容错性)
- BASE:如果一个系统不能达到一致性, 那么应该使其能够达到最终一致性

## 2PC, 3PC? 
- 2PC:  将事物提交分为两个阶段一是事务请求与执行; 二是提交事务与回滚
- 3PC: 对2PC最主要的阻塞的缺点进行改进, 将第二个阶段进行拆分为2部分为预提交与提交

## 什么是RMI? 什么是RPC?
- RMI: 远程方法调用
- RPC: 远程方法控制

## RPC与REST区别?
- RPC: 一般使用TCP, 效率高, 灵活性低, 适用于基础组件
- REST:基于HTTP, 效率低, 灵活性高, 便于调试

## 什么是一致性哈希?
将服务器分不到环形节点上, 并将数据映射到环形节点上, 然后按照逆时针方式将数据指向第一个遇到的服务器

## 反向代理与CDN加速的区别?
- 反向代理: 应用服务器机房附近
- CND加速: 通信应用商缓存静态资源, 用户请求时从最近的服务器上获取该资源

## 大型网站核心架构要素?
- 高可用
- 高性能
- 可扩展性
- 可伸缩性
- 安全性

## 网站性能测试的主要指标?
- 响应
- 并发量
- 任务请求量: QPS, TPS, HPS
- 性能计数: IO吞吐, CPU使用率, 内存读写

## 性能测试包括哪些? 
- 性能测试
- 压力测试
- 负载测试

## Web前端性能优化?
- 浏览器端: 
资源压缩; css放上面js放下面; 资源合并减少请求次数; 减少不必要的cookie传输
- 反向代理服务器
- CDN加速

## 应用服务器性能优化?
- 集群
- 分布式
- 异步处理
- 代码优化

## 典型的网站分层架构?
- 应用层
- 服务层
- 数据层

## 如何实现应用层高可用?
使用集群, 无状态转移

## 应用服务的Session如何管理?
- 持久化: 数据库
- 粘性Session: 将用户请求转发到指定服务器, 接下来该用户的请求都会转发到该服务器上
- session复制
- session服务器
- cookie携带
- 缓存

## 如何实现高可用服务器?
- 分级管理
- 降级
- 异步
- 幂等性
- 超时设置

## 如何实现高可用数据?
高可用数据要保证一致性, 可用性, 持久性, 容错性

- 数据备份: 冷备份, 热备份
- 失效转移

## 如何实现网站的可伸缩性?
使用集群的方式实现网站的可伸缩性

## 什么是负载均衡? 有哪些实现方式? 
负载均衡是将用户请求转发到空闲的服务器上保证服务器性能均衡

实现方式: 
- HTTP重定向负载均衡
- 反向代理服务器
- DNS域名解析: 设置多个A记录
- IP负载均衡: LVS-NAT
- 数据链路层负载均衡: 修改MAC

## 四层负载均衡与七层负载均衡? 二层负载均衡? 三层负载均衡?
- 四层负载均衡: 传输层负载均衡, 根据报文中的目的地之和端口选择内部服务器, 仅建立一次TCP连接
- 七层负载均衡: 应用层的负载均衡, 需要简历两次TCP连接, 负载均衡服务器接收请求后修改目的地址发送给真正处理应用的服务器, 处理完之后发给负载均衡服务器, 负载均衡服务器接收处理完的数据并修改发送地址然后将响应发送给用户; 需要建立两次TCP连接; 是网络更加智能化

## LVS? LVS-NAT? LVS-DR? LVS-Tun? Lvs-FULLNAT?
分为Director Server, Real Server
- lvs-nat:修改目的IP, 连接两次TCP连接
- LVS-DR: 修改目的Mac

## Nginx与LVS比较?
- Nginx相当于代理服务器在应用层进行处理
- LVS在传输层和链路层进行处理

## 正向代理和反向代理?
- 正向代理: 用户自己选择代理服务器
- 反向代理: 应用机房附近的服务器

## Nginx负载均衡策略?
- 轮询: 性能差别不大的服务器
- 随机: 性能不一的服务器
- 随机轮询: 初始服务器随机, 然后按照轮询的方式选择服务器
- 哈希ip: 根据用户请求转发到相应服务器, 为保证可用性可以采用一致性哈希
- 权重轮询: Nginx默认轮询算法, 根据服务器性能给予权重

## 网站攻击方式?
- SQL注入
- 路径遍历
- 错误页面展示
- 文件上传
- XSS
- CRSF
- 页面代码

## 如何实现服务限流(有哪些限流策略)?
前端与服务端, 前端限流较难可以通过nginx对ip, 用户名等进行分配; 服务端如Hystrix, 以及数据库(红线, 力保数据库)
常用算法: 漏桶算法与令牌算法
具体实现: 
1. Java限流工具RateLimiter
2. 使用Java的阻塞队列DelayQueue
3. 使用Redis, 使用计数器与计时器.计时器内计数器不超过指定数量即可, 否则阻塞或拒绝

## 分布式事务解决方案?
- 全局id
- 数据库悲观锁

## 如何实现单点登录?
- cookie
- 独立系统
- 页面重定向

---
## 什么是zookeeper? 原理? session, ZNode, 版本, 顺序访问
一个分布式协同服务, 注册与发现, 分布式锁, 负载均衡

## 什么是Dubbo? 框架图? 有哪些节点角色? 
阿里巴巴分布式框架

角色
- container
- provider
- consumer
- register
- monitor

## kafka?
消息中间件

## Hbase?
列式存储

## springCloud与Dubbo区别?
前者有一系列的模块, 使用REST方式通信

后者使用RPC进行通信, 功能少, 需要自己扩展

## springCloud基本功能?
- Euraka: 服务注册发现
- Ribbon: 负载均衡
- Hystrix: 熔断
- Feign:声明式调用方法
- config: 分布式配置
- zuul: 网关服务
- zipkin: 链路跟踪

## Eureka? 可以被什么替代? 与zookeeper比较? 还有哪些注册服务? zookeeper可以实现负载均衡嘛?
可以被zookeeper或consul替代

- Euraka使用AP理论
- Zookeeper使用CP理论

zookeeper可以实现负载均衡

## Ribbon负载策略?
轮询, 权重, 随机Ip, 空闲

## Hystrix容错实现方式? 熔断、资源隔离、降级. 限流?
- 资源隔离
- 熔断: 熔断机制, 一定时间内超过一定比例请求失效后会变为开路状态, 5s中过后变为半开状态进行请求, 请求成功变为闭路, 请求失败变为开路状态
- 限流: 防止请求过大

## Alibaba Sentinel 熔断降级方式?
- 请求并发
- 请求响应时间

## Feign?
声明式调用

## 网关服务? 什么是网关?
网关服务也是一个服务器, 用作路由, 过滤, 协议转换

网关: 网间连接器, 可以进行协议转换

## 配置中心? SpringCloud Bus?
springcloud config分布式配置中心, 加上bus之后刷新服务器就可以动态更改配置

- 配置原理: 配置服务中心从远端GIT拉取配置文件, 并在本地Git一份, configClient从configServer获取自己对应的配置文件

- 当远端仓库Git配置文件发生改变, configServer是如何通知configClient的? 
Springcloud Bus会向外提供一个http借口`/bus/refresh`, 将这个接口配置到远程git的webhook上, 当git内容发生改变时会调用这个接口, Bus就会通知configServer, configServer会发布更新消息到消息总线的消息队列中, 其它服务订阅到该消息就会进行刷新, 从而实现整个微服务进行自动刷新

## zipkin? +
分布式节点服务想zipkin服务注册, 然后将自身调用数据发送给服务器, 服务器根据调用生成依赖

## 微服务设计准则?
- AKF: 集群, 分布式, 区域
- 无状态服务
- 无状态通信
- 前后端分离

## 如何保证幂等性?
- 代码可重用
- token机制
- 唯一索引
- 悲观锁
- 乐观锁
- 分布式锁

## RabbitMQ?
消息中间件

## 为什么使用RabbitMQ? 如何保证消息正确发送? 如何保证消息接收方消费了消息? 如何避免消费重复投递或重复消费? 基于什么传输? 消息如何分发? 如何保证消息可靠传输? 如何保证消息顺序性?
- 异步, 销峰, 解耦
- 通过确认机制保证消息发送
- 信道确认
- 全局唯一id
- 基于信道传输
- 轮询方式发送
- 三个地方保证消息可靠传输
发送发: 通过确认机制
发送过程: 持久化
接收方: 不自动确认
- 通过对消息进行编号

## 使用消息队列的好处? 使用消息队列会带来什么问题?
好处: 异步, 销峰, 解耦
坏处: 增加系统复杂度; 系统可用性降低; 一致性问题 